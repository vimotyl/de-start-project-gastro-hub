Добрый день!
Все комментарии и объяснения по скриптам
указала в качестве комментариев в самом коде.

Здесь укажу вопросы, возникшие в процессе выполнения проекта.



Вопрос 1.
По заданию 6 из проекта: "Изменить цены на капучино"

Я выбрала блокировку строк FOR NO KEY UPDATE,
в которые будем вносить изменения.
Но при этом читать эти строки другим транзакциями можно.
И получается, что при составлении отчета, например,
в него попадут неактуальные цены.

Правильно ли я поняла, что если мы накладываем блокировку на строки,
то ограничить чтение этих строк невозможно?
(только если наложить блокировку на всю таблицу)

Как в этом задании лучше поступить?




Вопрос 2.
Задумалась о том, как рассуждать, когда задаем поведение
внешнего ключа при удалении строк в родительской таблице
(ON DELETE RESTRICT / CASCADE / NO ACTION / SET NULL / SET DEFAULT)

Мне понятно, когда имеет смысл применять SET NULL и SET DEFAUL.
А вот с RESTRICT, CASCADE, NO ACTION не совсем.


Например, рассмотрим таблицу cafe.sales
CREATE TABLE cafe.sales (
	date date NOT NULL,
	restaurant_uuid uuid
		REFERENCES cafe.restaurants(restaurant_uuid) 
			ON DELETE RESTRICT,
	avg_check NUMERIC(8, 1),
	PRIMARY KEY (date, restaurant_uuid)
);


Поле restaurant_uuid ссылается на uuid в таблице с ресторанами.
С одной стороны, хочется запретить удалять рестораны.
Ведь если ресторан удалить, то часть строк в таблице с продажами
мы не сможем идентифицировать.
С другой стороны, мне кажется, могут возникнуть ситуации,
когда удаление ресторана потребуется с удалением всех продаж этого ресторана.

Вопрос: как делать выбор?




Вопрос 3.
Тяжелее всего для понимания дались в этом спринте темы:
- "Тип данных JSON и JSONB" (не всегда понимаю, какого типа возвращает
та или иная функция при извлечении данных из JSON),
- "Изоляции транзакций",
- "Блокировки".

Чувствую, что еще нужен материал и практика по этой теме.
Если можешь порекомендовать литературу / статьи / тренажер и др.
на эти темы, буду благодарна.


Спасибо :) 
